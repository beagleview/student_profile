{% extends 'students/base.html' %}

{% block title %}{{ student.full_name }} - Personality Tests{% endblock %}

{% block content %}
<div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
    <!-- Left Column - Student Info -->
    <div class="lg:col-span-1">
        <div class="bg-white rounded-lg shadow-lg mb-6">
            <div class="p-6 text-center">
                {% if student.photo %}
                    <img src="{{ student.photo.url }}" alt="{{ student.full_name }}" 
                         class="w-32 h-32 rounded-full object-cover mx-auto mb-4 border-4 border-gray-100 shadow-md">
                {% else %}
                    <div class="w-32 h-32 rounded-full bg-gray-100 flex items-center justify-center mx-auto mb-4 border-4 border-gray-100 shadow-md">
                        <i class="fas fa-user text-4xl text-gray-400"></i>
                    </div>
                {% endif %}
                
                <h4 class="text-xl font-bold text-primary-600 mb-2">{{ student.full_name }}</h4>
                <p class="text-gray-600 mb-1">นักเรียนชั้น ม.{{ student.level }}/{{ student.level }}</p>
                <p class="text-gray-600 mb-4">{{ student.age }} ปี</p>
                
                <!-- Personal Info -->
                <div class="border-t border-gray-200 pt-4 mt-4 space-y-2">
                    <p class="text-sm"><span class="font-semibold">Student ID:</span> {{ student.student_id }}</p>
                    <p class="text-sm"><span class="font-semibold">Student Number:</span> {{ student.student_number }}</p>
                    <p class="text-sm"><span class="font-semibold">Room:</span> {{ student.room }}</p>
                </div>
            </div>
        </div>

        <!-- Test Actions -->
        <div class="bg-white rounded-lg shadow-lg">
            <div class="bg-primary-600 text-white rounded-t-lg px-4 py-3">
                <h5 class="text-lg font-semibold mb-0">
                    <i class="fas fa-clipboard-list mr-2"></i>เอกสารการเรียน
                </h5>
            </div>
            <div class="p-4">
                <div class="space-y-3">
                    <a href="{% url 'holland_questionnaire' student.pk %}" class="w-full bg-white border border-primary-300 text-primary-600 hover:bg-primary-50 px-4 py-2 rounded-lg font-medium transition-colors inline-flex items-center justify-center">
                        <i class="fas fa-user-tie mr-2"></i>เริ่มทำแบบทดสอบ Holland
                    </a>
                    <a href="{% url 'ss_career_discovery' student.pk %}" class="w-full bg-white border border-green-300 text-green-600 hover:bg-green-50 px-4 py-2 rounded-lg font-medium transition-colors inline-flex items-center justify-center">
                        <i class="fas fa-brain mr-2"></i>เริ่มทำ Samsung Career Discovery
                    </a>
                    <a href="{% url 'student_detail' student.pk %}" class="w-full bg-white border border-gray-300 text-gray-600 hover:bg-gray-50 px-4 py-2 rounded-lg font-medium transition-colors inline-flex items-center justify-center">
                        <i class="fas fa-arrow-left mr-2"></i>กลับไปหน้ารายละเอียด
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Right Column - Test Results -->
    <div class="lg:col-span-3">
        <!-- Holland Test Results -->
        {% if holland_test %}
            <div class="bg-white rounded-lg shadow-lg mb-6">
                <div class="bg-blue-600 text-white rounded-t-lg px-6 py-4 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3 cursor-pointer" onclick="toggleCollapse('holland-results')">
                    <div>
                        <h5 class="text-lg font-semibold mb-1">
                            <i class="fas fa-briefcase mr-2"></i>แบบทดสอบความสนใจอาชีพ Dr. John L Holland
                            <i class="fas fa-chevron-down ml-2 transition-transform duration-200" id="holland-chevron"></i>
                        </h5>
                        <small class="text-blue-100">Career Interest Assessment</small>
                    </div>
                    <div>
                        <a href="{% url 'holland_questionnaire' student.pk %}" class="bg-white text-blue-600 hover:bg-blue-50 px-3 py-1 rounded text-sm font-medium transition-colors inline-flex items-center" onclick="event.stopPropagation()">
                            <i class="fas fa-edit mr-1"></i> แก้ไข
                        </a>
                    </div>
                </div>
                <div id="holland-results" class="p-6" style="display: none;">
                    <!-- Holland Radar Chart -->
                    <div class="text-center mb-6">
                        <canvas id="hollandChart" width="300" height="300"></canvas>
                    </div>
                    
                    <!-- Holland Results Summary -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h6 class="text-primary-600 font-semibold mb-4">Holland Code: {{ holland_test.holland_code }}</h6>
                            <div class="space-y-4">
                                <div>
                                    <div class="flex justify-between items-center mb-1">
                                        <small class="text-sm font-medium text-gray-700">นักสำรวจ (Realistic)</small>
                                        <small class="text-sm font-semibold text-gray-900">{{ holland_test.realistic_score }}%</small>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-2">
                                        <div class="bg-red-500 h-2 rounded-full" style="width: {{ holland_test.realistic_score }}%"></div>
                                    </div>
                                </div>
                                <div>
                                    <div class="flex justify-between items-center mb-1">
                                        <small class="text-sm font-medium text-gray-700">นักวิจัย (Investigative)</small>
                                        <small class="text-sm font-semibold text-gray-900">{{ holland_test.investigative_score }}%</small>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-2">
                                        <div class="bg-yellow-500 h-2 rounded-full" style="width: {{ holland_test.investigative_score }}%"></div>
                                    </div>
                                </div>
                                <div>
                                    <div class="flex justify-between items-center mb-1">
                                        <small class="text-sm font-medium text-gray-700">นักสร้างสรรค์ (Artistic)</small>
                                        <small class="text-sm font-semibold text-gray-900">{{ holland_test.artistic_score }}%</small>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-2">
                                        <div class="bg-green-500 h-2 rounded-full" style="width: {{ holland_test.artistic_score }}%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div>
                            <div class="space-y-4">
                                <div>
                                    <div class="flex justify-between items-center mb-1">
                                        <small class="text-sm font-medium text-gray-700">นักสังคม (Social)</small>
                                        <small class="text-sm font-semibold text-gray-900">{{ holland_test.social_score }}%</small>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-2">
                                        <div class="bg-blue-500 h-2 rounded-full" style="width: {{ holland_test.social_score }}%"></div>
                                    </div>
                                </div>
                                <div>
                                    <div class="flex justify-between items-center mb-1">
                                        <small class="text-sm font-medium text-gray-700">นักผจญภัย (Enterprising)</small>
                                        <small class="text-sm font-semibold text-gray-900">{{ holland_test.enterprising_score }}%</small>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-2">
                                        <div class="bg-primary-600 h-2 rounded-full" style="width: {{ holland_test.enterprising_score }}%"></div>
                                    </div>
                                </div>
                                <div>
                                    <div class="flex justify-between items-center mb-1">
                                        <small class="text-sm font-medium text-gray-700">นักระบบ (Conventional)</small>
                                        <small class="text-sm font-semibold text-gray-900">{{ holland_test.conventional_score }}%</small>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-2">
                                        <div class="bg-gray-600 h-2 rounded-full" style="width: {{ holland_test.conventional_score }}%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        {% else %}
            <div class="bg-white rounded-lg shadow-lg mb-6">
                <div class="bg-gray-100 rounded-t-lg px-6 py-4">
                    <h5 class="text-lg font-semibold text-gray-600 mb-0">
                        <i class="fas fa-briefcase mr-2"></i>แบบทดสอบความสนใจอาชีพ Dr. John L Holland
                    </h5>
                </div>
                <div class="p-8 text-center">
                    <i class="fas fa-clipboard-question text-6xl text-gray-400 mb-4"></i>
                    <h5 class="text-xl font-semibold text-gray-600 mb-2">ยังไม่ได้ทำแบบทดสอบ</h5>
                    <p class="text-gray-500 mb-6">เริ่มทำแบบทดสอบบุคลิกภาพอาชีพตามทฤษฎี Dr. Holland</p>
                    <a href="{% url 'holland_questionnaire' student.pk %}" class="bg-primary-600 hover:bg-primary-700 text-white px-6 py-3 rounded-lg font-medium transition-colors inline-flex items-center">
                        <i class="fas fa-play mr-2"></i>เริ่มทำแบบทดสอบ
                    </a>
                </div>
            </div>
        {% endif %}

        <!-- Gardner Test Results -->
        {% if gardner_test %}
            <div class="bg-white rounded-lg shadow-lg">
                <div class="bg-green-600 text-white rounded-t-lg px-6 py-4 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3 cursor-pointer" onclick="toggleCollapse('gardner-results')">
                    <div>
                        <h5 class="text-lg font-semibold mb-1">
                            <i class="fas fa-brain mr-2"></i>Samsung Career Discovery Assessment
                            <i class="fas fa-chevron-down ml-2 transition-transform duration-200" id="gardner-chevron"></i>
                        </h5>
                        <small class="text-green-100">Multiple Intelligence Assessment</small>
                    </div>
                    <div>
                        <a href="{% url 'ss_career_discovery' student.pk %}" class="bg-white text-green-600 hover:bg-green-50 px-3 py-1 rounded text-sm font-medium transition-colors inline-flex items-center" onclick="event.stopPropagation()">
                            <i class="fas fa-edit mr-1"></i> แก้ไข
                        </a>
                    </div>
                </div>
                <div id="gardner-results" class="p-6" style="display: none;">
                    <!-- Gardner Radar Chart -->
                    <div class="text-center mb-6">
                        <canvas id="gardnerChart" width="300" height="300"></canvas>
                    </div>
                    
                    <!-- Gardner Results Summary -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="space-y-4">
                            <div>
                                <div class="flex justify-between items-center mb-1">
                                    <small class="text-sm font-medium text-gray-700">ภาษาศาสตร์</small>
                                    <small class="text-sm font-semibold text-gray-900">{{ gardner_test.linguistic_score }}%</small>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-2">
                                    <div class="h-2 rounded-full" style="width: {{ gardner_test.linguistic_score }}%; background-color: #ff6b6b;"></div>
                                </div>
                            </div>
                            <div>
                                <div class="flex justify-between items-center mb-1">
                                    <small class="text-sm font-medium text-gray-700">คณิตศาสตร์-ตรรกะ</small>
                                    <small class="text-sm font-semibold text-gray-900">{{ gardner_test.logical_score }}%</small>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-2">
                                    <div class="h-2 rounded-full" style="width: {{ gardner_test.logical_score }}%; background-color: #4ecdc4;"></div>
                                </div>
                            </div>
                            <div>
                                <div class="flex justify-between items-center mb-1">
                                    <small class="text-sm font-medium text-gray-700">มิติสัมพันธ์</small>
                                    <small class="text-sm font-semibold text-gray-900">{{ gardner_test.spatial_score }}%</small>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-2">
                                    <div class="h-2 rounded-full" style="width: {{ gardner_test.spatial_score }}%; background-color: #45b7d1;"></div>
                                </div>
                            </div>
                            <div>
                                <div class="flex justify-between items-center mb-1">
                                    <small class="text-sm font-medium text-gray-700">ดนตรี</small>
                                    <small class="text-sm font-semibold text-gray-900">{{ gardner_test.musical_score }}%</small>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-2">
                                    <div class="h-2 rounded-full" style="width: {{ gardner_test.musical_score }}%; background-color: #96ceb4;"></div>
                                </div>
                            </div>
                        </div>
                        <div class="space-y-4">
                            <div>
                                <div class="flex justify-between items-center mb-1">
                                    <small class="text-sm font-medium text-gray-700">กายเคลื่อนไหว</small>
                                    <small class="text-sm font-semibold text-gray-900">{{ gardner_test.bodily_score }}%</small>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-2">
                                    <div class="h-2 rounded-full" style="width: {{ gardner_test.bodily_score }}%; background-color: #feca57;"></div>
                                </div>
                            </div>
                            <div>
                                <div class="flex justify-between items-center mb-1">
                                    <small class="text-sm font-medium text-gray-700">มนุษยสัมพันธ์</small>
                                    <small class="text-sm font-semibold text-gray-900">{{ gardner_test.interpersonal_score }}%</small>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-2">
                                    <div class="h-2 rounded-full" style="width: {{ gardner_test.interpersonal_score }}%; background-color: #ff9ff3;"></div>
                                </div>
                            </div>
                            <div>
                                <div class="flex justify-between items-center mb-1">
                                    <small class="text-sm font-medium text-gray-700">เข้าใจตนเอง</small>
                                    <small class="text-sm font-semibold text-gray-900">{{ gardner_test.intrapersonal_score }}%</small>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-2">
                                    <div class="h-2 rounded-full" style="width: {{ gardner_test.intrapersonal_score }}%; background-color: #54a0ff;"></div>
                                </div>
                            </div>
                            <div>
                                <div class="flex justify-between items-center mb-1">
                                    <small class="text-sm font-medium text-gray-700">ธรรมชาติวิทยา</small>
                                    <small class="text-sm font-semibold text-gray-900">{{ gardner_test.naturalist_score }}%</small>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-2">
                                    <div class="h-2 rounded-full" style="width: {{ gardner_test.naturalist_score }}%; background-color: #5f27cd;"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        {% else %}
            <div class="bg-white rounded-lg shadow-lg">
                <div class="bg-gray-100 rounded-t-lg px-6 py-4">
                    <h5 class="text-lg font-semibold text-gray-600 mb-0">
                        <i class="fas fa-brain mr-2"></i>Samsung Career Discovery Assessment
                    </h5>
                </div>
                <div class="p-8 text-center">
                    <i class="fas fa-brain text-6xl text-gray-400 mb-4"></i>
                    <h5 class="text-xl font-semibold text-gray-600 mb-2">ยังไม่ได้ทำแบบทดสอบ</h5>
                    <p class="text-gray-500 mb-6">เริ่มทำแบบทดสอบพหุปัญญาตามทฤษฎี Dr. Howard Gardner</p>
                    <a href="{% url 'ss_career_discovery' student.pk %}" class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-medium transition-colors inline-flex items-center">
                        <i class="fas fa-play mr-2"></i>เริ่มทำ Samsung Career Discovery
                    </a>
                </div>
            </div>
        {% endif %}
    </div>
</div>

        <!-- Results Summary -->
        {% if holland_test and gardner_test %}
            <div class="bg-white rounded-lg shadow-lg mt-6">
                <div class="bg-yellow-600 text-white rounded-t-lg px-6 py-4 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3 cursor-pointer" onclick="toggleCollapse('summary-results')">
                    <div>
                        <h5 class="text-lg font-semibold mb-1">
                            <i class="fas fa-chart-bar mr-2"></i>สรุปผลการประเมิน
                            <i class="fas fa-chevron-down ml-2 transition-transform duration-200" id="summary-chevron"></i>
                        </h5>
                        <small class="text-yellow-100">Combined Assessment Summary</small>
                    </div>
                </div>
                <div id="summary-results" class="p-6" style="display: none;">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div>
                            <h6 class="text-blue-600 font-semibold mb-2">ลำดับ 1</h6>
                            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                                <h6 class="font-semibold text-blue-800 mb-2">ความสามารถด้านการวิเคราะห์และการคิดอย่างเป็นระบบ</h6>
                                <div class="w-full bg-blue-200 rounded-full h-3 mb-2">
                                    <div class="bg-blue-600 h-3 rounded-full flex items-center justify-center text-white text-xs font-medium" style="width: 66.67%">66.67%</div>
                                </div>
                                <small class="text-blue-600">ตามแนวทฤษฎี Dr. Holland และ Dr. Gardner</small>
                            </div>
                        </div>
                        <div>
                            <h6 class="text-green-600 font-semibold mb-2">ลำดับ 2</h6>
                            <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                                <h6 class="font-semibold text-green-800 mb-2">ความสามารถทางด้านการสื่อสารและเข้าใจผู้อื่น</h6>
                                <div class="w-full bg-green-200 rounded-full h-3 mb-2">
                                    <div class="bg-green-600 h-3 rounded-full flex items-center justify-center text-white text-xs font-medium" style="width: 61.11%">61.11%</div>
                                </div>
                                <small class="text-green-600">ความสามารถทางด้านการสื่อสารและเข้าใจผู้อื่น</small>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Additional Insights -->
                    <div>
                        <h6 class="text-gray-800 font-semibold mb-4">การแนะแนวเพิ่มเติม:</h6>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="bg-white border-2 border-blue-200 rounded-lg p-4 text-center">
                                <h6 class="text-blue-600 font-semibold mb-1">ลำดับ 3</h6>
                                <p class="text-sm text-gray-600 mb-2">ความสามารถด้านการสร้างสรรค์</p>
                                <div class="inline-block bg-gray-500 text-white px-2 py-1 rounded text-sm font-medium">47.06%</div>
                            </div>
                            <div class="bg-white border-2 border-cyan-200 rounded-lg p-4 text-center">
                                <h6 class="text-cyan-600 font-semibold mb-1">ลำดับ 4</h6>
                                <p class="text-sm text-gray-600 mb-2">ความสามารถด้านการทำงานเป็นทีม</p>
                                <div class="inline-block bg-gray-500 text-white px-2 py-1 rounded text-sm font-medium">41.67%</div>
                            </div>
                            <div class="bg-white border-2 border-yellow-200 rounded-lg p-4 text-center">
                                <h6 class="text-yellow-600 font-semibold mb-1">ลำดับ 5</h6>
                                <p class="text-sm text-gray-600 mb-2">ความสามารถด้านศิลปะและดนตรี</p>
                                <div class="inline-block bg-gray-500 text-white px-2 py-1 rounded text-sm font-medium">35.71%</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}

<!-- Back to Student Details -->
<div class="mt-6">
    <div class="text-center">
        <a href="{% url 'student_detail' student.pk %}" class="bg-white border border-gray-300 text-gray-600 hover:bg-gray-50 px-6 py-2 rounded-lg font-medium transition-colors inline-flex items-center mr-3">
            <i class="fas fa-arrow-left mr-2"></i>กลับไปหน้ารายละเอียดนักเรียน
        </a>
        <a href="{% url 'student_list' %}" class="bg-white border border-primary-300 text-primary-600 hover:bg-primary-50 px-6 py-2 rounded-lg font-medium transition-colors inline-flex items-center">
            <i class="fas fa-users mr-2"></i>ดูรายชื่อนักเรียนทั้งหมด
        </a>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
    .student-photo-large {
        width: 150px;
        height: 150px;
        object-fit: cover;
        border-radius: 50%;
        margin: 0 auto;
        border: 3px solid #f8f9fa;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .progress-group {
        margin-bottom: 15px;
    }
    
    .progress {
        height: 8px;
        border-radius: 4px;
    }
    
    .card-header h5 {
        font-size: 1rem;
        font-weight: 600;
    }
    
    .alert {
        border-radius: 8px;
    }
    
    canvas {
        max-width: 100%;
        height: auto;
    }
</style>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
{% if holland_test %}
// Holland Radar Chart
const hollandCtx = document.getElementById('hollandChart').getContext('2d');
new Chart(hollandCtx, {
    type: 'radar',
    data: {
        labels: ['นักสำรวจ', 'นักวิจัย', 'นักสร้างสรรค์', 'นักสังคม', 'นักผจญภัย', 'นักระบบ'],
        datasets: [{
            label: 'Holland Score',
            data: [
                {{ holland_test.realistic_score }},
                {{ holland_test.investigative_score }},
                {{ holland_test.artistic_score }},
                {{ holland_test.social_score }},
                {{ holland_test.enterprising_score }},
                {{ holland_test.conventional_score }}
            ],
            backgroundColor: 'rgba(54, 162, 235, 0.2)',
            borderColor: 'rgba(54, 162, 235, 1)',
            borderWidth: 2,
            pointBackgroundColor: 'rgba(54, 162, 235, 1)',
        }]
    },
    options: {
        responsive: true,
        scales: {
            r: {
                angleLines: {
                    display: true
                },
                suggestedMin: 0,
                suggestedMax: 100,
                ticks: {
                    stepSize: 25
                }
            }
        },
        plugins: {
            legend: {
                display: false
            }
        }
    }
});
{% endif %}

{% if gardner_test %}
// Gardner Radar Chart
const gardnerCtx = document.getElementById('gardnerChart').getContext('2d');
new Chart(gardnerCtx, {
    type: 'radar',
    data: {
        labels: ['ภาษา', 'คณิตศาสตร์', 'มิติสัมพันธ์', 'ดนตรี', 'กายเคลื่อนไหว', 'มนุษยสัมพันธ์', 'เข้าใจตนเอง', 'ธรรมชาติ'],
        datasets: [{
            label: 'Gardner Score',
            data: [
                {{ gardner_test.linguistic_score }},
                {{ gardner_test.logical_score }},
                {{ gardner_test.spatial_score }},
                {{ gardner_test.musical_score }},
                {{ gardner_test.bodily_score }},
                {{ gardner_test.interpersonal_score }},
                {{ gardner_test.intrapersonal_score }},
                {{ gardner_test.naturalist_score }}
            ],
            backgroundColor: 'rgba(255, 99, 132, 0.2)',
            borderColor: 'rgba(255, 99, 132, 1)',
            borderWidth: 2,
            pointBackgroundColor: 'rgba(255, 99, 132, 1)',
        }]
    },
    options: {
        responsive: true,
        scales: {
            r: {
                angleLines: {
                    display: true
                },
                suggestedMin: 0,
                suggestedMax: 100,
                ticks: {
                    stepSize: 25
                }
            }
        },
        plugins: {
            legend: {
                display: false
            }
        }
    }
});
{% endif %}

// Toggle function for collapsible sections
function toggleCollapse(sectionId) {
    const content = document.getElementById(sectionId);
    const chevron = document.getElementById(sectionId.replace('-results', '-chevron'));
    
    if (content.style.display === 'none') {
        content.style.display = 'block';
        chevron.style.transform = 'rotate(180deg)';
    } else {
        content.style.display = 'none';
        chevron.style.transform = 'rotate(0deg)';
    }
}
</script>
{% endblock %}
